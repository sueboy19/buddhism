<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <title>buddhism</title>
    <style>
        .print{
            position:relative;
            font-size: 20pt;
        }

        @page {
            /*margin: 1cm;*/ /*print邊界*/ 
            size: A4; /*列印紙張大小 210mm × 297mm 72 dpi (web) = 595 X 842 pixels */
        }

        @media print {
            table.table-bordered > thead > tr > th {
                border:1px solid black !important;
            }
            table.table-bordered > tbody > tr > td {
                border:1px solid black !important;
            }
            
            /*頁碼*/
            body {  
                counter-reset: print;
            }  
            .print::after {   
                position: absolute;  
                margin: 0 0 -40px 0;
                top: 1470px;  
                right: 50%;  /* 0 */
                counter-increment: print;  
                content: "頁： " counter(print);  
            }  
            /*頁碼*/
        }
        
        .print{
            page-break-after:always; /*print分頁面*/
        }
    </style>
	<script src="js/vue.js"></script>
	<script src="js/axios.min.js"></script>
	<script src="js/lodash.min.js"></script>
    <script src="js/polyfill.min.js"></script>
    <script src="js/globalVariable.js"></script>
    <link rel="stylesheet" href="css/bootstrap.min.css">
</head>
<body>
    <div id="app">
        <div class="print" v-for="(page, index) in pagezhangqis ">
            <h3>所有消災祈福名單</h3> <!-- class="text-center" -->
            <table class="table table-sm table-bordered" style="table-layout:fixed">
                <thead>
                    <tr>
                        <th scope="col" style="width: 100px;">姓名</th>
                        <th scope="col" style="width: 400px;">地址</th>
                        <th scope="col" style="width: 100px;">姓名</th>
                        <th scope="col" style="width: 400px;">地址</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>{{page[0][1].name}}</td><td>{{page[0][1].m_addr}}</td>
                        <td>{{page[1][1].name}}</td><td>{{page[1][1].m_addr}}</td>
                    </tr>
                    <tr>
                        <td>{{page[0][2].name}}</td><td>{{page[0][2].m_addr}}</td>
                        <td>{{page[1][2].name}}</td><td>{{page[1][2].m_addr}}</td>
                    </tr>
                    <tr>
                        <td>{{page[0][3].name}}</td><td>{{page[0][3].m_addr}}</td>
                        <td>{{page[1][3].name}}</td><td>{{page[1][3].m_addr}}</td>
                    </tr>
                    <tr>
                        <td>{{page[0][4].name}}</td><td>{{page[0][4].m_addr}}</td>
                        <td>{{page[1][4].name}}</td><td>{{page[1][4].m_addr}}</td>
                    </tr>
                    <tr>
                        <td>{{page[0][5].name}}</td><td>{{page[0][5].m_addr}}</td>
                        <td>{{page[1][5].name}}</td><td>{{page[1][5].m_addr}}</td>
                    </tr>
                    <tr>
                        <td>{{page[0][6].name}}</td><td>{{page[0][6].m_addr}}</td>
                        <td>{{page[1][6].name}}</td><td>{{page[1][6].m_addr}}</td>
                    </tr>
                    <tr>
                        <td>{{page[0][7].name}}</td><td>{{page[0][7].m_addr}}</td>
                        <td>{{page[1][7].name}}</td><td>{{page[1][7].m_addr}}</td>
                    </tr>
                    <tr>
                        <td>{{page[0][8].name}}</td><td>{{page[0][8].m_addr}}</td>
                        <td>{{page[1][8].name}}</td><td>{{page[1][8].m_addr}}</td>
                    </tr>
                    <tr></tr>
                        <td>{{page[0][9].name}}</td><td>{{page[0][9].m_addr}}</td>
                        <td>{{page[1][9].name}}</td><td>{{page[1][9].m_addr}}</td>
                    </tr>
                    <tr>
                        <td>{{page[0][10].name}}</td><td>{{page[0][10].m_addr}}</td>
                        <td>{{page[1][10].name}}</td><td>{{page[1][10].m_addr}}</td>
                    </tr>
                    <tr>
                        <td>{{page[0][11].name}}</td><td>{{page[0][11].m_addr}}</td>
                        <td>{{page[1][11].name}}</td><td>{{page[1][11].m_addr}}</td>
                    </tr>
                    <tr>
                        <td>{{page[0][12].name}}</td><td>{{page[0][12].m_addr}}</td>
                        <td>{{page[1][12].name}}</td><td>{{page[1][12].m_addr}}</td>
                    </tr>
                    <tr>
                        <td>{{page[0][13].name}}</td><td>{{page[0][13].m_addr}}</td>
                        <td>{{page[1][13].name}}</td><td>{{page[1][13].m_addr}}</td>
                    </tr>
                    <tr>
                        <td>{{page[0][14].name}}</td><td>{{page[0][14].m_addr}}</td>
                        <td>{{page[1][14].name}}</td><td>{{page[1][14].m_addr}}</td>
                    </tr>
                    <tr>
                        <td>{{page[0][15].name}}</td><td>{{page[0][15].m_addr}}</td>
                        <td>{{page[1][15].name}}</td><td>{{page[1][15].m_addr}}</td>
                    </tr>
                    <tr>
                        <td>{{page[0][16].name}}</td><td>{{page[0][16].m_addr}}</td>
                        <td>{{page[1][16].name}}</td><td>{{page[1][16].m_addr}}</td>
                    </tr>
                    <tr>
                        <td>{{page[0][17].name}}</td><td>{{page[0][17].m_addr}}</td>
                        <td>{{page[1][17].name}}</td><td>{{page[1][17].m_addr}}</td>
                    </tr>
                    <tr>
                        <td>{{page[0][18].name}}</td><td>{{page[0][18].m_addr}}</td>
                        <td>{{page[1][18].name}}</td><td>{{page[1][18].m_addr}}</td>
                    </tr>
                    <tr>
                        <td>{{page[0][19].name}}</td><td>{{page[0][19].m_addr}}</td>
                        <td>{{page[1][19].name}}</td><td>{{page[1][19].m_addr}}</td>
                    </tr>
                    <tr>
                        <td>{{page[0][20].name}}</td><td>{{page[0][20].m_addr}}</td>
                        <td>{{page[1][20].name}}</td><td>{{page[1][20].m_addr}}</td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div><!--app-->
</body>
<script>
    const client = axios.create({
		baseURL: customBashUrl,
		json: true
	});
	
	var app = new Vue({
        el: '#app',
        data: {
            zhangqis: [],
            //pagezhangqis: [],
        },
        ready: function() {
                //this.getCustomers()
        },
        async created() {
            this.refreshzhangqis()
        },
        methods: {
            async execute (method, resource, data) {
                return client({
                    method,
                    url: resource,
                    data,
                    /*headers: {
                            Authorization: `Bearer ${accessToken}`
                    }*/
                }).then(req => {
                    return req.data
                })
            },
            getzhangqisinfoall() {
                return this.execute('get', `/zhangqisinfoall`)
            },
            async refreshzhangqis() {
                this.zhangqis = await this.getzhangqisinfoall()
            },
        },
		computed: {
            pagezhangqis: function() {
                oldaddr = ""
                pageRecCount = 40

                this.zhangqis.forEach((element, index) => {  //去除重覆地址
                    if(oldaddr != element.m_addr.trim()){
                        oldaddr = element.m_addr.trim()
                    }else{
                        // 如果跨頁時，第一筆不能是空值
                        this.zhangqis[index].m_addr = index % pageRecCount != 0 ? "" : element.m_addr.trim()
                        // this.zhangqis[index].m_addr = ""  //地址相同清空
                    }
                })

                AllPagesCount = Math.floor(this.zhangqis.length/pageRecCount) +1 //一頁40筆資料
                pagesCount = 0
                allpages = []
                page = []
                pageLeft = [{},{},{},{},{},{},{},{},{},{},
                            {},{},{},{},{},{},{},{},{},{},
                            {},]
                pageRight = [{},{},{},{},{},{},{},{},{},{},
                            {},{},{},{},{},{},{},{},{},{},
                            {},]

                this.zhangqis.forEach((element, index) => {
                    tindex = index - (pageRecCount * pagesCount) +1 //符合陣列第1筆開始
                    //console.log("tindex", tindex, index, pagesCount)
                    pageLeftRightIndex = tindex
                    if(pageLeftRightIndex<=20){pageLeft[pageLeftRightIndex]=element}
                    if(pageLeftRightIndex>=21 && pageLeftRightIndex<=40){pageRight[pageLeftRightIndex-20]=element}
                    
                    if(tindex == pageRecCount){ //每頁輸出
                        pagesCount++
                        page[0]=pageLeft
                        page[1]=pageRight
                        allpages.push(page)
                        /*console.log("pagescount", pagesCount)
                        console.log("pageleft", pageLeft)
                        console.log("pagesright", pageRight)
                        console.log("page", page)*/
                        pageLeft = [{},{},{},{},{},{},{},{},{},{},
                                    {},{},{},{},{},{},{},{},{},{},
                                    {},]
                        pageRight = [{},{},{},{},{},{},{},{},{},{},
                                    {},{},{},{},{},{},{},{},{},{},
                                    {},]
                        page = []
                    }
                });
                
                page[0]=pageLeft
                page[1]=pageRight
                allpages.push(page)

                //page[0]=pageLeft
                //page[1]=pageRight
                //allpages.push(page)
                //console.log(allpages)
                return allpages
            },
            orderedzhangqis: function() {
                return _.orderBy(this.zhangqis, 'm_num')
            },
            filteredRows: function(){
                var filter_name = this.filter_name.toLowerCase();

                return ( this.filter_name.trim() !== '' ) ? 
                    this.zhangqis.filter(function(d){ return d.m_num.toLowerCase().indexOf(filter_name) > -1; }) : 
                    _.orderBy(this.zhangqis, 'm_num');
            },
        }
        
    })

</script>
</html>